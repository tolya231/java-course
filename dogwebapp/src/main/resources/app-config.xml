<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd">

  <bean id="inMemoryDogDao" class="com.epam.repositories.inMemory.InMemoryDogDao"/>

  <bean id="jdbcConnectionHolder" class="com.epam.jdbc.JdbcConnectionHolder" depends-on="flyway">
    <constructor-arg ref="h2dataSource"/>
  </bean>

  <bean id="jdbcDogDao" class="com.epam.repositories.jdbcDao.JdbcDogDao">
    <constructor-arg ref="jdbcConnectionHolder"/>
  </bean>

  <bean id="dogService" class="com.epam.services.DogService">
    <constructor-arg ref="jdbcDogDao"/>
  </bean>

  <aop:aspectj-autoproxy/>
  <bean id="myAspect" class="com.epam.aop.aspects.TransactionalAspect">
    <constructor-arg ref="jdbcConnectionHolder"/>
  </bean>

  <bean id="dynamicDogServiceProxy" class="com.epam.services.transactions.TransactionalProxy" factory-method="createProxy">
    <constructor-arg ref="jdbcConnectionHolder"/>
    <constructor-arg>
      <bean class="com.epam.services.DogService">
        <constructor-arg ref="jdbcDogDao"/>
      </bean>
    </constructor-arg>
    <constructor-arg value="com.epam.services.DogCrudService"/>
  </bean>

<!--  <bean id="cjlibDogServiceProxy" class="com.epam.services.transactions.CglibTransactionalDogService" factory-method="createProxy">-->
<!--    <constructor-arg ref="jdbcConnectionHolder"/>-->
<!--    <constructor-arg>-->
<!--      <bean class="com.epam.services.DogService">-->
<!--        <constructor-arg ref="jdbcDogDao"/>-->
<!--      </bean>-->
<!--    </constructor-arg>-->
<!--  </bean>-->


  <bean id="h2dataSource" class="org.h2.jdbcx.JdbcDataSource" depends-on="h2Server">
    <property name="URL" value="jdbc:h2:mem:prod;DB_CLOSE_DELAY=-1;DATABASE_TO_LOWER=TRUE"/>
    <property name="user" value="admin"/>
    <property name="password" value="admin"/>
  </bean>

  <bean id="flyway" class="org.flywaydb.core.Flyway" init-method="migrate">
    <property name="baselineOnMigrate" value="true" />
    <property name="dataSource" ref="h2dataSource" />
  </bean>

  <!--h2-console-->
  <bean id="h2Server" class="org.h2.tools.Server" factory-method="createTcpServer"
    init-method="start"
    destroy-method="stop" depends-on="h2WebServer">
    <constructor-arg value="-tcp,-tcpAllowOthers,-tcpPort,9092"/>
  </bean>
  <bean id="h2WebServer" class="org.h2.tools.Server" factory-method="createWebServer"
    init-method="start"
    destroy-method="stop">
    <constructor-arg value="-web,-webAllowOthers,-webPort,8082"/>
  </bean>

</beans>
